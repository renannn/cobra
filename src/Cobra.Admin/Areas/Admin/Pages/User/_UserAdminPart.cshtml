@model UserCardItemViewModel

@{
	var user = Model.User;
}

<div class="mt-5">
	<div class="row">
		<div class="col-md-7">
			<div class="table-responsive">
				<table id="all-roles-list" class="table table-striped table-hover table-bordered">
					<thead class="thead-light">
						<tr>
							<th class="text-center">Recurso do usuário</th>
							<th class="text-center">Situação</th>
							<th class="text-center">Autoridade</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<span aria-hidden="true" class="ti-user"></span>
								<strong>Nome do usuário</strong>
							</td>
							<td class="text-center">@user.UserName</td>
							<td class="text-center">
								<a asp-controller="UserProfile"
								   asp-action="AdminEdit"
								   asp-route-id="@user.Id"
								   class="btn btn-info btn-sm">
									Editar perfil
									<span aria-hidden="true" class="ti-edit"></span>
								</a>
								<a asp-controller="ChangeUserPassword"
								   asp-action="Index"
								   asp-route-id="@user.Id"
								   class="btn btn-info btn-sm mt-2">
									Alterar senha
									<span aria-hidden="true" class="fas fa-edit"></span>
								</a>
							</td>
						</tr>
						<tr>
							<td>
								<span aria-hidden="true" class="fas fa-user-circle"></span>
								<strong>Status do usuário</strong>
							</td>
							<td class="text-center">
							</td>
							<td class="text-center">
								<form method="post"
									  asp-asp-page-handler="ChangeUserStat"
									  role="form"
									  data-ajax="true"
									  data-ajax-alert-confirm="O status do usuário @user. Alterar o DisplayName?"
									  data-ajax-begin="dataAjaxBegin"
									  data-ajax-success="dataAjaxSuccess"
									  data-ajax-failure="dataAjaxFailure"
									  data-ajax-update="#usercard-@user.Id">
									<input name="userId" value="@user.Id" type="hidden" />
								</form>
							</td>
						</tr>
						<tr>
							<td>
								<span aria-hidden="true" class="fas fa-envelope"></span>
								<strong>
									Status de e-mail
								</strong>
							</td>
							<td class="text-center">
								@if (user.EmailConfirmed)
								{
									<span class="badge badge-success badge-pill text-white">Confirmado</span>
								}
								else
								{
									<span class="badge badge-warning badge-pill text-white">Não confirmado</span>
								}
							</td>
							<td class="text-center">
								@if (!user.EmailConfirmed)
								{
									<form method="post" 
									  asp-asp-page-handler="ActivateUserEmailStat"
									  role="form"
									  data-ajax="true"
									  data-ajax-begin="dataAjaxBegin"
									  data-ajax-success="dataAjaxSuccess"
									  data-ajax-failure="dataAjaxFailure"
									  data-ajax-update="#usercard-@user.Id">
										<input name="userId" value="@user.Id" type="hidden" />
										<button type="submit" class="btn btn-info btn-sm">
											Confirmar
											<span aria-hidden="true" class="fas fa-thumbs-up"></span>
										</button>
									</form>
								}
							</td>
						</tr>
						<tr>
							<td>
								<span aria-hidden="true" class="fas fa-lock"></span>
								<strong>
									Lockdown
								</strong>
							</td>
							<td class="text-center">
								@if (user.LockoutEnabled)
								{
									<span class="badge badge-success badge-pill text-white">Ativo</span>
								}
								else
								{
									<span class="badge badge-warning badge-pill text-white">Desactivado</span>
								}
							</td>
							<td class="text-center">
								<form method="post" 
									  asp-asp-page-handler="ChangeUserLockoutMode"
									  role="form"
									  data-ajax="true"
									  data-ajax-begin="dataAjaxBegin"
									  data-ajax-success="dataAjaxSuccess"
									  data-ajax-failure="dataAjaxFailure"
									  data-ajax-update="#usercard-@user.Id">
									<input name="userId" value="@user.Id" type="hidden" />
									@if (user.LockoutEnabled)
									{
										<input name="activate" value="false" type="hidden" />
										<button type="submit" class="btn btn-danger btn-sm">
											Desabilitar
											<span aria-hidden="true" class="fas fa-thumbs-down"></span>
										</button>
									}
									else
									{
										<input name="activate" value="true" type="hidden" />
										<button type="submit" class="btn btn-info btn-sm">
											Ativar
											<span aria-hidden="true" class="fas fa-thumbs-up"></span>
										</button>
									}
								</form>
							</td>
						</tr>
						<tr>
							<td>
								<span aria-hidden="true" class="fas fa-calendar-check"></span>
								<strong>
									Quando a conta estara bloqqueada
								</strong>
							</td>
							<td class="text-center">
								@if (user.LockoutEnd != null)
								{
									@user.LockoutEnd.Value
								}
							</td>
							<td class="text-center">
								@if (user.LockoutEnd != null)
								{
									<form method="post" 
									  asp-asp-page-handler="EndUserLockout"
									  role="form"
									  data-ajax="true"
									  data-ajax-begin="dataAjaxBegin"
									  data-ajax-success="dataAjaxSuccess"
									  data-ajax-failure="dataAjaxFailure"
									  data-ajax-update="#usercard-@user.Id">
										<input name="userId" value="@user.Id" type="hidden" />
										<button type="submit" class="btn btn-info btn-sm">
											Remover bloqueio
											<span aria-hidden="true" class="fas fa-thumbs-up"></span>
										</button>
									</form>
								}
							</td>
						</tr>
						<tr>
							<td>
								<span aria-hidden="true" class="fas fa-user-secret"></span>
								<strong>
									Validação em duas etapas
								</strong>
							</td>
							<td class="text-center">
								@if (user.TwoFactorEnabled)
								{
									<span class="badge badge-success badge-pill text-white">
										Ativo
									</span>
								}
								else
								{
									<span class="badge badge-warning badge-pill text-white">Desativado</span>
								}
							</td>
							<td class="text-center">
								<form method="post" 
									  asp-asp-page-handler="ChangeUserTwoFactorAuthenticationStat"
									  role="form"
									  data-ajax="true"
									  data-ajax-begin="dataAjaxBegin"
									  data-ajax-success="dataAjaxSuccess"
									  data-ajax-failure="dataAjaxFailure"
									  data-ajax-update="#usercard-@user.Id">
									<input name="userId" value="@user.Id" type="hidden" />
									@if (user.TwoFactorEnabled)
									{
										<input name="activate" value="false" type="hidden" />
										<button type="submit" class="btn btn-danger btn-sm">
											Desabilitar
											<span aria-hidden="true" class="fas fa-thumbs-down"></span>
										</button>
									}
									else
									{
										<input name="activate" value="true" type="hidden" />
										<button type="submit" class="btn btn-info btn-sm">
											Ativar
											<span aria-hidden="true" class="fas fa-thumbs-up"></span>
										</button>
									}
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div class="col-md-5">
			<div class="table-responsive">
				<table id="all-roles-list" class="table table-striped table-hover table-bordered">
					<thead class="thead-light">
						<tr>
							<th class="text-center">
								<span aria-hidden="true" class="fas fa-id-badge"></span>
								Regras de usuário
							</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<form method="post"
									  asp-page-handler="ChangeUserRoles"
									  role="form"
									  data-ajax="true"
									  data-ajax-begin="dataAjaxBegin"
									  data-ajax-success="dataAjaxSuccess"
									  data-ajax-failure="dataAjaxFailure"
									  data-ajax-update="#usercard-@user.Id">
									<input name="userId" value="@user.Id" type="hidden" />
									@foreach (var role in Model.Roles)
									{
										var selected = user.Roles.Any(userRole => userRole.RoleId == role.Id) ? "checked" : "";
										<div>
											<input type="checkbox" name="roleIds" value="@role.Id" @selected />
											@role.Name
										</div>
									}
									<button type="submit" class="btn btn-info btn-sm top10">
										Aplicar mudanças de regras de usuário
										<span aria-hidden="true" class="fas fa-thumbs-up"></span>
									</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>